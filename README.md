# plugwatch

A mediocre Minecraft server plugin updater.

![image](https://user-images.githubusercontent.com/86647101/173960483-3441b095-71d0-489d-8d3f-51eb3f506d47.png)

## Acknowledgments

Some code is derived from [pluGET](https://github.com/Neocky/pluGET) by [Neocky](https://github.com/Neocky).

## Features

| Repository/server | Auto-download | RegEx filtering | Notes                                    |
| ----------------- | ------------- | --------------- | ---------------------------------------- |
| SpigotMC          | ✅            | N/A             | Latest version                           |
| DevBukkit         | ✅            | N/A             | Latest version                           |
| GitHub releases   | ✅            | ✅ (link)       | Latest stable/pre-release assets         |
| GitHub Actions    | ✅            | ✅ (filename)   | Latest non-expired artifact              |
| Jenkins           | ✅            | ✅ (link)       | Latest stable/successful build artifacts |
| Direct links      | ✅            | N/A             |

## Usage

1. Clone the repository
2. Create configuration files `settings.toml` and `.secrets.toml` in the same directory (refer [below](#configuration))
3. Run `py plugwatch.py`

If `plugins.json` doesn't exist yet, the script will generate it from all the plugins already in your plugins path (default `plugins`).

To generate missing `plugins.json` entries, run `py plugwatch.py --generate` or `py plugwatch.py -g`.

To process a single plugin, run `py plugwatch.py (plugin name)`

## Configuration

### `settings.toml`

```ini
# User agent for browsing the interwebz.
userAgent = "--user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36"

# Precedence list for plugin downloads.
precedence = ["directUrls", "github", "jenkins", "spigot", "bukkit"]

# Path where plugins are processed and downloaded.
pluginsPath = "plugins"

# Whether to automatically download and replace plugins.
autoDownloads = false

# Whether to force replacement of plugins regardless of version.
forceRedownload = false

# Whether to prefer stable builds/releases.
preferStable = true

# Whether to consider stable releases/builds if more recent (will be ignored if preferStable is true).
considerStable = true

# Whether to prefer GitHub Actions artifacts over releases.
preferActions = false

# Delay for checking updates between plugins in seconds.
delay = 0
```

### `.secrets.toml`

```ini
# Token to use for GitHub API requests (scope public_repo is required)
githubToken = "token"
```

## Schema

Using an editor with [JSON schema support](https://json-schema.org/implementations.html#editors) support, use the following template for `plugins.json`:

```jsonc
{
  "$schema": "https://github.com/shifterest/plugwatch/raw/main/schema.json",
  "plugins": [
    {
      // The name of the plugin. This should be generated by the script.
      "name": "PluginName",

      // Precedence list for plugin downloads.
      "precedence": ["spigot", "github"],
      // If true, only the repositories/servers from precedence will be iterated.
      // Otherwise, precedence will be iterated along with precedence in settings.toml.
      "forcePrecedence": false,
      // Filename to use for this specific plugin.
      "filename": "CustomPluginName.jar",

      // The SpigotMC ID of the plugin. To get the ID of a SpigotMC plugin, go to its
      // webpage and copy the trailing numbers.
      // https://www.spigotmc.org/resources/essentialsx.9089/ -> 9089
      "spigotID": 12345,
      // The DevBukkit slug of the plugin. To get the slug of a DevBukkit plugin, go to
      // its webpage and copy everything after the last slash.
      // https://dev.bukkit.org/projects/worldedit -> worldedit
      "bukkitSlug": "plugin-slug",

      // The GitHub repository of the plugin.
      "githubRepo": "github/repo",
      // Regular expressions used to filter out a single plugin (if releases/artifacts
      // have multiple files).
      // If the name/link of the file satisfies githubRegEx, it will be included.
      // If the name/link of the file satisfies githubRegExInverse, it will be excluded.
      "githubRegEx": ".*",
      "githubRegExInverse": ".^",

      // The Jenkins server of the plugin.
      "jenkinsServer": "jenkins.server.com/job/PluginName",
      // Same as githubRegEx and githubRegExInverse, respectively.
      "jenkinsRegEx": ".*",
      "jenkinsRegExInverse": ".^",

      // Direct download URLS for the plugin.
      "stableDirectUrl": "https://download.plugin.com/stable",
      "experimentalDirectUrl": "https://download.plugin.com/experimental"
    }
  ]
}
```

Take note that each entry corresponds to **a single** plugin only. If multiple plugins come from the same repository/server, use regular expressions for each plugin instead.

## To-do

- Code better lol
